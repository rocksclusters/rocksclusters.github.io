<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>5.3 The Grid Universe</TITLE>
<META NAME="description" CONTENT="5.3 The Grid Universe">
<META NAME="keywords" CONTENT="ref">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="ref.css">

<LINK REL="next" HREF="5_4HTCondor_Job.html">
<LINK REL="previous" HREF="5_2Connecting_HTCondor.html">
<LINK REL="up" HREF="5_Grid_Computing.html">
<LINK REL="next" HREF="5_4HTCondor_Job.html">
</HEAD>

<BODY  BGCOLOR=#FFFFFF >
<!--Navigation Panel-->
<A NAME="tex2html2028"
  HREF="5_4HTCondor_Job.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2022"
  HREF="5_Grid_Computing.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2016"
  HREF="5_2Connecting_HTCondor.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2024"
  HREF="Contents.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2026"
  HREF="Index.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2029"
  HREF="5_4HTCondor_Job.html">5.4 The HTCondor Job</A>
<B> Up:</B> <A NAME="tex2html2023"
  HREF="5_Grid_Computing.html">5. Grid Computing</A>
<B> Previous:</B> <A NAME="tex2html2017"
  HREF="5_2Connecting_HTCondor.html">5.2 Connecting HTCondor Pools</A>
 &nbsp; <B>  <A NAME="tex2html2025"
  HREF="Contents.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html2027"
  HREF="Index.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html2030"
  HREF="5_3Grid_Universe.html#SECTION00631000000000000000">5.3.1 HTCondor-C, The condor Grid Type </A>
<UL>
<LI><A NAME="tex2html2031"
  HREF="5_3Grid_Universe.html#SECTION00631100000000000000">5.3.1.1 HTCondor-C Configuration</A>
<LI><A NAME="tex2html2032"
  HREF="5_3Grid_Universe.html#SECTION00631200000000000000">5.3.1.2 HTCondor-C Job Submission</A>
<LI><A NAME="tex2html2033"
  HREF="5_3Grid_Universe.html#SECTION00631300000000000000">5.3.1.3 HTCondor-C Jobs Between Differing Platforms</A>
</UL>
<BR>
<LI><A NAME="tex2html2034"
  HREF="5_3Grid_Universe.html#SECTION00632000000000000000">5.3.2 HTCondor-G, the gt2, and gt5 Grid Types</A>
<UL>
<LI><A NAME="tex2html2035"
  HREF="5_3Grid_Universe.html#SECTION00632100000000000000">5.3.2.1 Globus Protocols and Terminology</A>
<LI><A NAME="tex2html2036"
  HREF="5_3Grid_Universe.html#SECTION00632200000000000000">5.3.2.2 The gt2 Grid Type</A>
<LI><A NAME="tex2html2037"
  HREF="5_3Grid_Universe.html#SECTION00632300000000000000">5.3.2.3 The gt5 Grid Type</A>
<LI><A NAME="tex2html2038"
  HREF="5_3Grid_Universe.html#SECTION00632400000000000000">5.3.2.4 Credential Management with <I>MyProxy</I></A>
<LI><A NAME="tex2html2039"
  HREF="5_3Grid_Universe.html#SECTION00632500000000000000">5.3.2.5 The Grid Monitor</A>
<LI><A NAME="tex2html2040"
  HREF="5_3Grid_Universe.html#SECTION00632600000000000000">5.3.2.6 Limitations of HTCondor-G</A>
</UL>
<BR>
<LI><A NAME="tex2html2041"
  HREF="5_3Grid_Universe.html#SECTION00633000000000000000">5.3.3 The nordugrid Grid Type </A>
<LI><A NAME="tex2html2042"
  HREF="5_3Grid_Universe.html#SECTION00634000000000000000">5.3.4 The unicore Grid Type </A>
<LI><A NAME="tex2html2043"
  HREF="5_3Grid_Universe.html#SECTION00635000000000000000">5.3.5 The batch Grid Type (for PBS, LSF, and SGE) </A>
<LI><A NAME="tex2html2044"
  HREF="5_3Grid_Universe.html#SECTION00636000000000000000">5.3.6 The EC2 Grid Type </A>
<UL>
<LI><A NAME="tex2html2045"
  HREF="5_3Grid_Universe.html#SECTION00636100000000000000">5.3.6.1 EC2 Job Submission</A>
<LI><A NAME="tex2html2046"
  HREF="5_3Grid_Universe.html#SECTION00636200000000000000">5.3.6.2 Termination of EC2 Jobs</A>
<LI><A NAME="tex2html2047"
  HREF="5_3Grid_Universe.html#SECTION00636300000000000000">5.3.6.3 Using Spot Instances</A>
<LI><A NAME="tex2html2048"
  HREF="5_3Grid_Universe.html#SECTION00636400000000000000">5.3.6.4 EC2 Configuration Variables</A>
</UL>
<BR>
<LI><A NAME="tex2html2049"
  HREF="5_3Grid_Universe.html#SECTION00637000000000000000">5.3.7 The GCE Grid Type </A>
<UL>
<LI><A NAME="tex2html2050"
  HREF="5_3Grid_Universe.html#SECTION00637100000000000000">5.3.7.1 GCE Job Submission</A>
<LI><A NAME="tex2html2051"
  HREF="5_3Grid_Universe.html#SECTION00637200000000000000">5.3.7.2 GCE Configuration Variables</A>
</UL>
<BR>
<LI><A NAME="tex2html2052"
  HREF="5_3Grid_Universe.html#SECTION00638000000000000000">5.3.8 The cream Grid Type </A>
<LI><A NAME="tex2html2053"
  HREF="5_3Grid_Universe.html#SECTION00639000000000000000">5.3.9 The deltacloud Grid Type </A>
<UL>
<LI><A NAME="tex2html2054"
  HREF="5_3Grid_Universe.html#SECTION00639100000000000000">5.3.9.1 Deltacloud Job Submission</A>
<LI><A NAME="tex2html2055"
  HREF="5_3Grid_Universe.html#SECTION00639200000000000000">5.3.9.2 Configuration for Deltacloud</A>
</UL>
<BR>
<LI><A NAME="tex2html2056"
  HREF="5_3Grid_Universe.html#SECTION006310000000000000000">5.3.10 The BOINC Grid Type </A>
<UL>
<LI><A NAME="tex2html2057"
  HREF="5_3Grid_Universe.html#SECTION006310100000000000000">5.3.10.1 BOINC Job Submission</A>
<LI><A NAME="tex2html2058"
  HREF="5_3Grid_Universe.html#SECTION006310200000000000000">5.3.10.2 BOINC Configuration Variables</A>
</UL>
<BR>
<LI><A NAME="tex2html2059"
  HREF="5_3Grid_Universe.html#SECTION006311000000000000000">5.3.11 Matchmaking in the Grid Universe</A>
<UL>
<LI><A NAME="tex2html2060"
  HREF="5_3Grid_Universe.html#SECTION006311100000000000000">5.3.11.1 Job Submission</A>
<LI><A NAME="tex2html2061"
  HREF="5_3Grid_Universe.html#SECTION006311200000000000000">5.3.11.2 Advertising Grid Resources to HTCondor</A>
<LI><A NAME="tex2html2062"
  HREF="5_3Grid_Universe.html#SECTION006311300000000000000">5.3.11.3 Advanced usage</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION00630000000000000000"></A><A NAME="sec:GridUniverse"></A>
<BR>
5.3 The Grid Universe
</H1>

<P>
<A NAME="47297"></A>

<P>

<H2><A NAME="SECTION00631000000000000000"></A><A NAME="sec:HTCondor-C"></A>
<BR>
5.3.1 HTCondor-C, The condor Grid Type 
</H2>

<P>
<A NAME="47299"></A>
HTCondor-C allows jobs in one machine's job queue to
be moved to another machine's job queue.
These machines may be far removed from each other,
providing powerful grid computation mechanisms,
while requiring only HTCondor software and its configuration.

<P>
HTCondor-C is highly resistant to network disconnections and machine failures on both the submission and remote sides.
An expected usage
sets up Personal HTCondor on a laptop,
submits some jobs that are sent to an HTCondor pool,
waits until the jobs are staged on the pool,
then turns off the laptop.
When the laptop reconnects at a later time,
any results can be pulled back.

<P>
HTCondor-C scales gracefully when compared with HTCondor's flocking
mechanism.
The machine upon which jobs are submitted
maintains a single process and network connection to a remote machine,
without regard to the number
of jobs queued or running.

<P>

<H3><A NAME="SECTION00631100000000000000"></A><A NAME="sec:HTCondor-C-Config"></A>
<A NAME="47301"></A>
<BR>
5.3.1.1 HTCondor-C Configuration
</H3>
There are two aspects to configuration to enable the
submission and execution of HTCondor-C jobs.
These two aspects correspond to the endpoints of the 
communication: there is the machine from which jobs are
submitted, and there is the remote machine upon which the
jobs are placed in the queue (executed).

<P>
Configuration of a machine from which jobs are submitted
requires a few extra configuration variables:

<P>
<PRE>
CONDOR_GAHP = $(SBIN)/condor_c-gahp
C_GAHP_LOG = /tmp/CGAHPLog.$(USERNAME)
C_GAHP_WORKER_THREAD_LOG = /tmp/CGAHPWorkerLog.$(USERNAME)
C_GAHP_WORKER_THREAD_LOCK = /tmp/CGAHPWorkerLock.$(USERNAME)
</PRE>
<P>
<A NAME="47304"></A>
<A NAME="47305"></A>
The acronym GAHP stands for Grid ASCII Helper Protocol.
A GAHP server provides grid-related services for a
variety of underlying middle-ware systems.
The configuration variable <TT>CONDOR_GAHP</TT><A NAME="47389"></A><A NAME="47390"></A>
gives a full path to the GAHP server utilized by HTCondor-C.
The configuration variable <TT>C_GAHP_LOG</TT><A NAME="47394"></A><A NAME="47395"></A> defines
the location of the log that the HTCondor GAHP server writes.
The log for the HTCondor GAHP is written as the user on whose
behalf it is running; thus the
<TT>C_GAHP_LOG</TT><A NAME="47399"></A><A NAME="47400"></A> configuration variable must point to a location the end
user can write to.

<P>
A submit machine must also have a <I>condor_collector</I> daemon to which the
<I>condor_schedd</I> daemon can submit a query.
The query is for the location (IP address and port)
of the intended remote machine's <I>condor_schedd</I> daemon.
This facilitates communication between the two machines.
This <I>condor_collector</I> does not need to be the same collector
that the local <I>condor_schedd</I> daemon reports to.

<P>
The machine upon which jobs are executed 
must also be configured correctly.
This machine must be running a <I>condor_schedd</I> daemon.
Unless specified explicitly in a submit file, 
<TT>CONDOR_HOST</TT> must point to a 
<I>condor_collector</I> daemon that it can write to,
and the machine upon which jobs are submitted can read from.
This facilitates communication between the two machines.

<P>
An important aspect of configuration is the security 
configuration relating to authentication.
HTCondor-C on the remote machine relies on an
authentication protocol to
know the identity of the user under which to run a job.
The following is a working example
of the security configuration for authentication.
This authentication method, CLAIMTOBE, 
trusts the identity claimed by a host or IP address.

<P>
<PRE>
SEC_DEFAULT_NEGOTIATION = OPTIONAL
SEC_DEFAULT_AUTHENTICATION_METHODS = CLAIMTOBE
</PRE>
<P>
Other working authentication methods are
GSI, SSL, KERBEROS, and FS.

<P>

<H3><A NAME="SECTION00631200000000000000"></A><A NAME="sec:HTCondor-C-Submit"></A>
<A NAME="47320"></A>
<A NAME="47321"></A>
<BR>
5.3.1.2 HTCondor-C Job Submission
</H3>
Job submission of HTCondor-C jobs is the same as for any HTCondor job.
The <B>universe</B> is <B>grid</B>.
The submit command <B>grid_resource</B><A NAME="47421"></A> specifies 
the remote <I>condor_schedd</I> daemon to which
the job should be submitted, and its value consists of three fields.
The first field is the grid type, which is <B>condor</B>.
The second field is the name of the remote <I>condor_schedd</I> daemon.
Its value is the
same as the <I>condor_schedd</I> ClassAd attribute <TT>Name</TT> on the
remote machine.
The third field is the name of the remote pool's <I>condor_collector</I>.

<P>
The following represents a minimal submit description file for
a job.

<P>
<PRE>
# minimal submit description file for an HTCondor-C job
universe = grid
executable = myjob
output = myoutput
error = myerror
log = mylog

grid_resource = condor joe@remotemachine.example.com remotecentralmanager.example.com
+remote_jobuniverse = 5
+remote_requirements = True
+remote_ShouldTransferFiles = "YES"
+remote_WhenToTransferOutput = "ON_EXIT"
queue
</PRE>
<P>
The remote machine needs to understand the attributes of the job.
These are specified in the submit description file using the '+'
syntax, followed by the string <B>remote_</B>.
At a minimum, this will be the job's <B>universe</B> and the job's
<B>requirements</B>.
It is likely that other attributes specific to the
job's <B>universe</B> (on the remote pool) will also be necessary.
Note that attributes set with '+' are inserted directly into
the job's ClassAd.  
Specify attributes as they 
must appear in the job's ClassAd, not the submit description file. 
For example,
the <B>universe</B><A NAME="47437"></A> is specified using an integer assigned for
a job ClassAd <TT>JobUniverse</TT>.
Similarly, place quotation marks around string 
expressions.
As an example, a submit description file would ordinarily contain
<PRE>
when_to_transfer_output = ON_EXIT
</PRE>This must appear in the HTCondor-C job submit description file as
<PRE>
+remote_WhenToTransferOutput = "ON_EXIT"
</PRE>
<P>
For convenience, the specific entries of 
<B>universe</B>, 
<B>remote_grid_resource</B>, 
<B>globus_rsl</B><A NAME="47442"></A>, and
<B>globus_xml</B><A NAME="47444"></A>
may be specified as <B>remote_</B> commands
without the leading '+'. 
Instead of 
<PRE>
+remote_universe = 5
</PRE>
<P>
the submit description file command may appear as

<P>
<PRE>
remote_universe = vanilla
</PRE>
<P>
Similarly, the command
<PRE>
+remote_gridresource = "condor schedd.example.com cm.example.com"
</PRE>
<P>
may be given as

<P>
<PRE>
remote_grid_resource = condor schedd.example.com cm.example.com
</PRE>
<P>
For the given example,
the job is to be run as a <B>vanilla</B> 
<B>universe</B> job at the remote pool.
The (remote pool's) <I>condor_schedd</I> daemon is likely to
place its job queue data on a local disk 
and execute the job on another machine within the pool of machines.
This implies that the file systems for the resulting submit machine
(the machine specified by <B>remote_schedd</B>) and
the execute machine (the machine that runs the job) will
<I>not</I> be shared.
Thus,
the two inserted ClassAd attributes
<PRE>
+remote_ShouldTransferFiles = "YES"
+remote_WhenToTransferOutput = "ON_EXIT"
</PRE>are used to invoke HTCondor's file transfer mechanism. 

<P>
For communication between <I>condor_schedd</I> daemons on the submit
and remote machines,
the location of the remote <I>condor_schedd</I> daemon is needed.
This information resides in the <I>condor_collector</I> of the remote
machine's pool.
The third field of the <B>grid_resource</B><A NAME="47458"></A> command in the submit description file
says which <I>condor_collector</I> should be queried for the remote <I>condor_schedd</I>
daemon's location.
An example of this submit command is
<PRE>
grid_resource = condor schedd.example.com machine1.example.com
</PRE>If the remote <I>condor_collector</I> is not listening on the standard port
(9618), then the port it <I>is</I> listening on needs to be specified:
<PRE>
grid_resource = condor schedd.example.comd machine1.example.com:12345
</PRE>
<P>
File transfer of a job's executable, <TT>stdin</TT>, <TT>stdout</TT>, and
<TT>stderr</TT> are automatic.
When other files need to be transferred using HTCondor's file transfer
mechanism
(see section&nbsp;<A HREF="2_5Submitting_Job.html#sec:file-transfer">2.5.4</A> on page&nbsp;<A HREF="2_5Submitting_Job.html#sec:file-transfer"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>),
the mechanism is applied based on the resulting job universe on the
remote machine.

<P>

<H3><A NAME="SECTION00631300000000000000"></A><A NAME="sec:HTCondor-C-CrossPlatform"></A>
<BR>
5.3.1.3 HTCondor-C Jobs Between Differing Platforms
</H3>

<P>
HTCondor-C jobs given to a remote machine running Windows
must specify the Windows domain of the remote machine.
This is accomplished by defining a ClassAd attribute for the job.
Where the Windows domain is different at the submit machine
from the remote machine, the submit description file 
defines the Windows domain of the remote machine with
<PRE>
  +remote_NTDomain = "DomainAtRemoteMachine"
</PRE>

<P>
A Windows machine not part of a domain
defines the Windows domain as the machine name.

<P>
<A NAME="47383"></A>

<P>
<A NAME="47578"></A>

<P>

<H2><A NAME="SECTION00632000000000000000"></A><A NAME="sec:HTCondor-G"></A>
<BR>
5.3.2 HTCondor-G, the gt2, and gt5 Grid Types
</H2>

<P>
HTCondor-G is the name given to HTCondor when <B>grid</B>
<B>universe</B> jobs are sent to grid resources utilizing
Globus software for job execution.
The Globus Toolkit provides a framework for building grid systems
and applications.
See the Globus Alliance web page at
<A NAME="tex2html66"
  HREF="http://www.globus.org">http://www.globus.org</A>
for descriptions and details of the Globus software.

<P>
HTCondor provides the same job management capabilities for HTCondor-G
jobs as for other jobs.
From HTCondor, a user may effectively submit jobs, manage jobs,
and have jobs execute on widely distributed machines.

<P>
It may appear that HTCondor-G is a simple replacement
for the Globus Toolkit's <I>globusrun</I> command.
However, HTCondor-G does much more.
It allows the submission of many jobs at once,
along with the monitoring of those jobs with a convenient interface.
There is notification when jobs complete or fail
and maintenance of Globus credentials
that may expire while a job is running.
On top of this, HTCondor-G is a fault-tolerant system;
if a machine crashes,
all of these functions are again available as the machine returns.

<P>

<H3><A NAME="SECTION00632100000000000000"></A><A NAME="sec:Globus-Protocols"></A>
<BR>
5.3.2.1 Globus Protocols and Terminology
</H3>
The Globus software provides a well-defined set of protocols
that allow authentication, data transfer, and remote job execution.
Authentication is a mechanism by which an identity is verified.
Given proper authentication, authorization to use a resource
is required.
Authorization is a policy that determines who is allowed to do what. 

<P>
HTCondor (and Globus) utilize the following protocols and terminology.
The protocols allow HTCondor to interact with grid machines toward
the end result of executing jobs.
<DL>
<DT><STRONG>GSI</STRONG></DT>
<DD><A NAME="47602"></A>
The Globus Toolkit's Grid Security Infrastructure (GSI) provides essential
<A NAME="47603"></A>
building blocks for other grid protocols and HTCondor-G.
This authentication and authorization system
makes it possible to authenticate a user just once,
using public key infrastructure (PKI) mechanisms to verify
a user-supplied grid credential.
GSI then handles the mapping of the grid credential to the
diverse local credentials and authentication/authorization mechanisms that
apply at each site. 
</DD>
<DT><STRONG>GRAM</STRONG></DT>
<DD>The Grid Resource Allocation and Management (GRAM) protocol supports remote
<A NAME="47604"></A>
<A NAME="47605"></A>
submission of a computational request (for example, to run a program)
to a remote computational resource,
and it supports subsequent monitoring and control of the computation. 
GRAM is the Globus protocol that HTCondor-G uses to talk to remote Globus
  jobmanagers.
</DD>
<DT><STRONG>GASS</STRONG></DT>
<DD>The Globus Toolkit's Global Access to Secondary Storage (GASS) service provides
<A NAME="47606"></A>
<A NAME="47607"></A>
mechanisms for transferring data to and from a remote HTTP, FTP, or GASS server. 
GASS is used by HTCondor for the 
<B>gt2</B> grid type
to transfer a job's files
to and from the machine where the job is submitted and the remote resource.
</DD>
<DT><STRONG>GridFTP</STRONG></DT>
<DD>GridFTP is an extension of FTP that provides strong security and 
high-performance options for large data transfers.
</DD>
<DT><STRONG>RSL</STRONG></DT>
<DD>RSL (Resource Specification Language)  is the language GRAM 
accepts to specify job information.
</DD>
<DT><STRONG>gatekeeper</STRONG></DT>
<DD>A gatekeeper is a software daemon executing on a remote machine on
the grid.
It is relevant only to the <B>gt2</B> grid type,
and this daemon handles the initial communication between
HTCondor and a remote resource.
</DD>
<DT><STRONG>jobmanager</STRONG></DT>
<DD>A jobmanager is
the Globus service that is initiated at a remote resource to submit,
keep track of, and manage grid I/O for jobs running on 
an underlying batch system.
There is a specific jobmanager for each type of
batch system supported by Globus (examples are HTCondor, LSF, and PBS).

<P>
</DD>
</DL>

<P>
In its interaction with Globus software,
HTCondor contains a GASS server, used to transfer the executable,
<TT>stdin</TT>, <TT>stdout</TT>, and <TT>stderr</TT> to and from
the remote job execution site.
HTCondor uses the GRAM protocol to contact the remote gatekeeper
and request that a new jobmanager be started.
The GRAM protocol is also used to when monitoring the job's progress.
HTCondor detects and intelligently handles cases
such as if the remote resource crashes.

<P>
There are now two different versions of the GRAM protocol in common
usage: <B>gt2</B> and <B>gt5</B>.
HTCondor supports both of them.
<DL>
<DT><STRONG>gt2</STRONG></DT>
<DD>This initial GRAM protocol is used in Globus Toolkit versions 1 and 2.
It is still used by many production systems.
Where available in the other, more recent versions of the protocol,
<B>gt2</B> is referred to as the pre-web services GRAM 
(or pre-WS GRAM) or GRAM2.

<P>
</DD>
<DT><STRONG>gt5</STRONG></DT>
<DD>This latest GRAM protocol is an extension of GRAM2 that is intended to
be more scalable and robust. It is usually referred to as GRAM5.
</DD>
</DL>

<P>

<H3><A NAME="SECTION00632200000000000000"></A><A NAME="sec:Using-gt2"></A>
<BR>
5.3.2.2 The gt2 Grid Type
</H3>

<P>
<A NAME="47620"></A>
<A NAME="47621"></A>
HTCondor-G supports submitting jobs to remote resources running
the Globus Toolkit's GRAM2 (or pre-WS GRAM) service. This flavor of GRAM
is the most common.
These HTCondor-G jobs are submitted the same as any other HTCondor job.
The <B>universe</B> is <B>grid</B>,
and the pre-web services GRAM protocol is specified by
setting the type of grid as <B>gt2</B> in the <B>grid_resource</B><A NAME="47795"></A>
command.

<P>
<A NAME="47626"></A>
<A NAME="47627"></A>
<A NAME="47628"></A>
Under HTCondor, successful job submission to the <B>grid</B> 
<B>universe</B> with <B>gt2</B>
requires credentials.
<A NAME="47632"></A>
An X.509 certificate is used to create a proxy,
and an account, authorization, or allocation to use a grid resource
is required.
For general information on proxies and certificates,
please consult the Globus page at 

<P>
<A NAME="tex2html67"
  HREF="http://www-unix.globus.org/toolkit/docs/4.0/security/key-index.html">http://www-unix.globus.org/toolkit/docs/4.0/security/key-index.html</A>
<P>
Before submitting a job to HTCondor under the <B>grid</B> universe,
use <I>grid-proxy-init</I> to create a proxy.

<P>
Here is a simple submit description file.
<A NAME="47636"></A>
The example specifies a <B>gt2</B> job to be run on
an NCSA machine.

<P>
<PRE>
executable = test
universe = grid
grid_resource = gt2 modi4.ncsa.uiuc.edu/jobmanager
output = test.out
log = test.log
queue
</PRE> 

<P>
The 
<B>executable</B><A NAME="47805"></A>
for this example is
transferred from the local machine to the remote machine.
By default, HTCondor transfers the executable, as well as any
files specified by an <B>input</B><A NAME="47807"></A> command.
Note that the executable must be compiled for its intended platform.

<P>
<A NAME="47642"></A>
The command <B>grid_resource</B><A NAME="47809"></A> is a required command
for grid universe jobs.
The second field specifies the scheduling software
to be used on the remote resource.
There is a specific jobmanager for each type of
batch system supported by Globus.
The full syntax for this command line appears as
<PRE>
grid_resource = gt2 machinename[:port]/jobmanagername[:X.509 distinguished name]
</PRE>The portions of this syntax specification enclosed within
square brackets ([ and ]) are optional.
On a machine where the jobmanager is listening on a nonstandard port,
include the port number.
The <code>jobmanagername</code> is a site-specific string.
The most common one is <code>jobmanager-fork</code>, but others are
<PRE>
jobmanager
jobmanager-condor
jobmanager-pbs
jobmanager-lsf
jobmanager-sge
</PRE>
The Globus software running on the remote resource
uses this string to identify and select the correct service
to perform.
Other <code>jobmanagername</code> strings are used,
where additional services are defined and implemented.

<P>
The job log file is maintained on the submit machine.

<P>
Example output from 
<I>condor_q</I> for this submission looks like:
<PRE>
% condor_q


-- Submitter: wireless48.cs.wisc.edu : &lt;128.105.48.148:33012&gt; : wireless48.cs.wi

 ID      OWNER         SUBMITTED     RUN_TIME ST PRI SIZE CMD
   7.0   smith        3/26 14:08   0+00:00:00 I  0   0.0  test

1 jobs; 1 idle, 0 running, 0 held
</PRE>
<P>
After a short time, the Globus resource accepts the job.
Again running <I>condor_q</I> will now result in

<P>
<PRE>
% condor_q


-- Submitter: wireless48.cs.wisc.edu : &lt;128.105.48.148:33012&gt; : wireless48.cs.wi

 ID      OWNER         SUBMITTED     RUN_TIME ST PRI SIZE CMD
   7.0   smith        3/26 14:08   0+00:01:15 R  0   0.0  test

1 jobs; 0 idle, 1 running, 0 held
</PRE>
<P>
Then, very shortly after that, the queue will be empty again,
because the job has finished:

<P>
<PRE>
% condor_q


-- Submitter: wireless48.cs.wisc.edu : &lt;128.105.48.148:33012&gt; : wireless48.cs.wi

 ID      OWNER            SUBMITTED     RUN_TIME ST PRI SIZE CMD

0 jobs; 0 idle, 0 running, 0 held
</PRE>
<P>
A second example of a submit description file runs the Unix <I>ls</I>
program on a different Globus resource.

<P>
<PRE>
executable = /bin/ls
transfer_executable = false
universe = grid
grid_resource = gt2 vulture.cs.wisc.edu/jobmanager
output = ls-test.out
log = ls-test.log
queue
</PRE><FONT SIZE="-1"> 
</FONT>
<P>
In this example, the executable (the binary) has been pre-staged.
The executable is on the remote machine, and it is not to
be transferred before execution.
Note that the required 
<B>grid_resource</B> and <B>universe</B>
commands are present.
The command
<PRE>
transfer_executable = false
</PRE>
within the submit description file identifies the executable
as being pre-staged.
In this case, the 
<B>executable</B>
command gives the path to the executable on the remote machine.

<P>
A third example submits a Perl script to be run as a submitted
HTCondor job.
The Perl script both lists and sets
environment variables for a job.
Save the following Perl script with the name <TT>env-test.pl</TT>,
to be used as an HTCondor job executable.

<P>
<PRE>
#!/usr/bin/env perl

foreach $key (sort keys(%ENV))
{
   print "$key = $ENV{$key}\n"
}

exit 0;
</PRE>

<P>
Run the Unix command
<PRE>
chmod 755 env-test.pl
</PRE>
to make the Perl script executable.

<P>
Now create the following submit description file.
Replace <TT>example.cs.wisc.edu/jobmanager</TT> with a resource
you are authorized to use.

<P>
<PRE>
executable = env-test.pl
universe = grid
grid_resource = gt2 example.cs.wisc.edu/jobmanager
environment = foo=bar; zot=qux
output = env-test.out
log = env-test.log
queue
</PRE>
<P>
When the job has completed, the output file, <TT>env-test.out</TT>,
should contain something like this:

<P>
<PRE>
GLOBUS_GRAM_JOB_CONTACT = https://example.cs.wisc.edu:36213/30905/1020633947/
GLOBUS_GRAM_MYJOB_CONTACT = URLx-nexus://example.cs.wisc.edu:36214
GLOBUS_LOCATION = /usr/local/globus
GLOBUS_REMOTE_IO_URL = /home/smith/.globus/.gass_cache/globus_gass_cache_1020633948
HOME = /home/smith
LANG = en_US
LOGNAME = smith
X509_USER_PROXY = /home/smith/.globus/.gass_cache/globus_gass_cache_1020633951
foo = bar
zot = qux
</PRE>
<P>
Of particular interest is the <TT>GLOBUS_REMOTE_IO_URL</TT>
environment variable.
HTCondor-G automatically starts up a GASS remote I/O
server on the submit machine.
Because of the potential for either side of the connection to fail,
the URL for the server cannot be passed directly to the job.
Instead, it is placed into a file, and the <TT>GLOBUS_REMOTE_IO_URL</TT>
environment variable points to this file.
Remote jobs can read this file and use the URL it contains
to access the remote GASS server running inside HTCondor-G.
If the location
of the GASS server changes (for example, if HTCondor-G restarts),
HTCondor-G will contact the Globus gatekeeper and update this file on
the machine where the job is running.
It is therefore important that all accesses to
the remote GASS server check this file for the latest location.

<P>
The following example is a Perl script that uses the GASS server in HTCondor-G
to copy input files to the execute machine.
In this example, the remote job
counts the number of lines in a file.

<P>
<PRE>
#!/usr/bin/env perl
use FileHandle;
use Cwd;

STDOUT-&gt;autoflush();
$gassUrl = `cat $ENV{GLOBUS_REMOTE_IO_URL}`;
chomp $gassUrl;

$ENV{LD_LIBRARY_PATH} = $ENV{GLOBUS_LOCATION}. "/lib";
$urlCopy = $ENV{GLOBUS_LOCATION}."/bin/globus-url-copy";

# globus-url-copy needs a full path name
$pwd = getcwd();
print "$urlCopy $gassUrl/etc/hosts file://$pwd/temporary.hosts\n\n";
`$urlCopy $gassUrl/etc/hosts file://$pwd/temporary.hosts`;

open(file, "temporary.hosts");
while(&lt;file&gt;) {
print $_;
}

exit 0;
</PRE>
<P>
The submit description file used to submit the Perl script as
an HTCondor job appears as:

<P>
<PRE>
executable = gass-example.pl
universe = grid
grid_resource = gt2 example.cs.wisc.edu/jobmanager
output = gass.out
log = gass.log
queue
</PRE>
<P>
There are two optional submit description file commands
of note:
<B>x509userproxy</B><A NAME="47824"></A> and
<B>globus_rsl</B><A NAME="47826"></A>.
The <B>x509userproxy</B> command specifies the path to
an X.509 proxy.
The command is of the form:
<PRE>
x509userproxy = /path/to/proxy
</PRE>
If this optional command is not present in the submit description file,
then HTCondor-G checks the value of the environment variable
<TT>X509_USER_PROXY</TT> for the location of the proxy.
If this environment variable is not present, then HTCondor-G
looks for the proxy in the file
<TT>/tmp/x509up_uXXXX</TT>,
where the characters <code>XXXX</code> in this file name are
replaced with the Unix user id.

<P>
The <B>globus_rsl</B> command is used to add additional
attribute settings to a job's RSL string.
The format of the <B>globus_rsl</B> command is
<PRE>
globus_rsl = (name=value)(name=value)
</PRE>
Here is an example of this command from a submit description file:
<PRE>
globus_rsl = (project=Test_Project)
</PRE>
This example's attribute name for the additional RSL is
<TT>project</TT>, and the value assigned is <TT>Test_Project</TT>.

<P>

<H3><A NAME="SECTION00632300000000000000"></A><A NAME="sec:Using-gt5"></A>
<BR>
5.3.2.3 The gt5 Grid Type
</H3>

<P>
<A NAME="47697"></A>
<A NAME="47698"></A>

<P>
The Globus GRAM5 protocol works the same as the gt2 grid type.
Its implementation differs from gt2 in the following 3 items:

<UL>
<LI>The Grid Monitor is disabled.
</LI>
<LI>Globus job managers are not stopped and restarted. 
</LI>
<LI>The configuration variable <TT>GRIDMANAGER_MAX_JOBMANAGERS_PER_RESOURCE</TT><A NAME="47835"></A><A NAME="47836"></A> 
is not applied (for gt5 jobs).
</LI>
</UL>

<P>
Normally, HTCondor will automatically detect whether a service is GRAM2 or
GRAM5 and interact with it accordingly. 
It does not matter whether gt2 or gt5 is specified. 
Disable this detection by setting
the configuration variable <TT>GRAM_VERSION_DETECTION</TT><A NAME="47840"></A><A NAME="47841"></A> to <TT>False</TT>.
If disabled, each resource must be accurately identified as either gt2 or gt5
in the <B>grid_resource</B> submit command.

<P>

<H3><A NAME="SECTION00632400000000000000"></A><A NAME="sec:My-Proxy"></A>
<BR>
5.3.2.4 Credential Management with <I>MyProxy</I>
</H3>
<A NAME="47776"></A>
HTCondor-G can use <I>MyProxy</I>
software to automatically renew GSI proxies for
<B>grid</B>
<B>universe</B> jobs with grid type
<B>gt2</B>.
<I>MyProxy</I> is a software component developed at
NCSA and used widely throughout the grid community.
For more information see:
<A NAME="tex2html68"
  HREF="http://grid.ncsa.illinois.edu/myproxy/">http://grid.ncsa.illinois.edu/myproxy/</A>
<P>
Difficulties with proxy expiration occur in two cases.
The first case are long running jobs, which do not complete
before the proxy expires.
The second case occurs when great numbers of jobs are submitted.
Some of the jobs may not yet be started
or not yet completed before the proxy expires.
One proposed solution to these difficulties is to generate
longer-lived proxies.
This, however, presents a greater security problem.
Remember that a GSI proxy is sent to the remote Globus resource.
If a proxy falls into the hands of a malicious user at the remote site,
the malicious user can impersonate the proxy owner
for the duration of the proxy's lifetime.
The longer the proxy's lifetime,
the more time a malicious user has to misuse the owner's credentials.
To minimize the
window of opportunity of a
malicious user, 
it is recommended that proxies have a short lifetime
(on the order of several hours).

<P>
The <I>MyProxy</I> software generates proxies using credentials
(a user certificate or a long-lived proxy) located on a secure
<I>MyProxy</I> server.
HTCondor-G talks to the MyProxy server,
renewing a proxy as it is about to expire.
Another advantage that this presents is it relieves the user
from having to store a GSI user certificate and private key
on the machine where jobs are submitted.
This may be particularly important if a shared HTCondor-G
submit machine is used by several users.

<P>
In the a typical case, the following steps occur:

<P>

<OL>
<LI>The user creates a long-lived credential
on a secure <I>MyProxy</I> server, using the
<I>myproxy-init</I> command.
Each organization generally has their own <I>MyProxy</I> server.

<P>
</LI>
<LI>The user creates a short-lived proxy
on a local submit machine,
using
<I>grid-proxy-init</I> or <I>myproxy-get-delegation</I>.

<P>
</LI>
<LI>The user submits
an HTCondor-G job,
specifying:
<DL>
<DT></DT>
<DD><I>MyProxy</I> server name (host:port)
</DD>
<DT></DT>
<DD><I>MyProxy</I> credential name (optional)
</DD>
<DT></DT>
<DD><I>MyProxy</I> password
</DD>
</DL>

<P>
</LI>
<LI>At the short-lived proxy expiration
HTCondor-G talks to
the <I>MyProxy</I> server to refresh the proxy.

<P>
</LI>
</OL>

<P>
HTCondor-G keeps track of the password to the <I>MyProxy</I> server
for credential renewal.
Although HTCondor-G tries to keep the password encrypted and secure,
it is still possible (although highly unlikely) for the password
to be intercepted from the HTCondor-G machine
(more precisely, from the machine that the
<I>condor_schedd</I> daemon that manages the grid universe jobs runs on,
which may be distinct from the machine from where jobs are submitted).
The following safeguard practices are recommended.

<P>

<OL>
<LI>Provide time limits
for credentials on the <I>MyProxy</I> server.
The default is one week, but you may want to make it shorter.

<P>
</LI>
<LI>Create several different <I>MyProxy</I> credentials,
maybe as many as one for each submitted job.
Each credential has a unique name,
which is identified with the
<TT>MyProxyCredentialName</TT> command in the submit description file.

<P>
</LI>
<LI>Use the following options
when initializing the credential on the <I>MyProxy</I> server:

<P>
<PRE>
myproxy-init -s &lt;host&gt; -x -r &lt;cert subject&gt; -k &lt;cred name&gt;
</PRE>
<P>
The option <B>-x -r </B><I>&lt;cert subject&gt;</I>
essentially tells the <I>MyProxy</I> server to require two forms
of authentication:
  
<OL>
<LI>a password (initially set with <I>myproxy-init</I>)
</LI>
<LI>an existing proxy (the proxy to be renewed)
  
</LI>
</OL>

<P>
</LI>
<LI>A submit description file may include the password.
An example contains commands of the form:
<PRE>
executable      = /usr/bin/my-executable
universe        = grid
grid_resource   = gt2 condor-unsup-7
MyProxyHost     = example.cs.wisc.edu:7512
MyProxyServerDN = /O=doesciencegrid.org/OU=People/CN=Jane Doe 25900
MyProxyPassword = password
MyProxyCredentialName = my_executable_run
queue
</PRE>Note that placing the password within the submit description file
is not really secure,
as it relies upon security provided by the file system.
This may still be better than option 5.

<P>
</LI>
<LI>Use the <B>-p</B> option to <I>condor_submit</I>.
The submit command appears as
<PRE>
condor_submit -p mypassword /home/user/myjob.submit
</PRE>The argument list for <I>condor_submit</I> defaults to
being publicly available.
An attacker with a login on that local machine could
generate a simple shell script
to watch for the password. 

<P>
</LI>
</OL>

<P>
Currently, HTCondor-G calls the
<I>myproxy-get-delegation</I> command-line tool,
passing it the necessary arguments.
The location of the
<I>myproxy-get-delegation</I> executable is determined by the
configuration variable
<TT>MYPROXY_GET_DELEGATION</TT><A NAME="47889"></A><A NAME="47890"></A> in the configuration file
on the HTCondor-G machine.
This variable is read by the <I>condor_gridmanager</I>.
If
<I>myproxy-get-delegation</I>
is a dynamically-linked executable
(verify this with <TT>ldd myproxy-get-delegation</TT>),
point
<TT>MYPROXY_GET_DELEGATION</TT>
to a wrapper shell script that sets
<TT>LD_LIBRARY_PATH</TT> to the correct <I>MyProxy</I>
library or Globus library directory and then
calls <I>myproxy-get-delegation</I>.
Here is an example of such a wrapper script:

<P>
<PRE>
#!/bin/sh
export LD_LIBRARY_PATH=/opt/myglobus/lib
exec /opt/myglobus/bin/myproxy-get-delegation $@
</PRE>
<H3><A NAME="SECTION00632500000000000000"></A><A NAME="sec:HTCondor-G-GridMonitor"></A>
<A NAME="48078"></A>
<A NAME="48079"></A>
<A NAME="48080"></A>
<BR>
5.3.2.5 The Grid Monitor
</H3>

<P>
HTCondor's Grid Monitor is designed to improve the scalability of
machines running the Globus Toolkit's GRAM2 gatekeeper.
Normally, this service runs a jobmanager process for 
every job submitted to the gatekeeper.
This includes both currently running jobs and jobs waiting in the queue.
Each jobmanager runs a Perl script at
frequent intervals (every 10 seconds) to poll the state of
its job in the local batch system.
For example, with 400 jobs submitted to a gatekeeper,
there will be 400 jobmanagers running,
each regularly starting a Perl script.
When a large number of jobs
have been submitted to a single gatekeeper,
this frequent polling can heavily load the gatekeeper.
When the gatekeeper is under heavy load,
the system can become non-responsive, and a variety of problems can occur.

<P>
HTCondor's Grid Monitor temporarily replaces these jobmanagers.
It is named the Grid Monitor, because it replaces the monitoring
(polling) duties previously done by jobmanagers.
When the Grid Monitor runs,
HTCondor attempts to start a single
process to poll all of a user's jobs at a given gatekeeper.
While a job is waiting in the queue, but not yet running,
HTCondor shuts down the associated jobmanager,
and instead relies on the Grid Monitor to report changes in status.
The jobmanager started to add the job to the remote
batch system queue is shut down.
The jobmanager restarts when the job begins running.

<P>
The Grid Monitor requires that the gatekeeper support the fork
jobmanager with the name <I>jobmanager-fork</I>.
If the gatekeeper does not support the fork jobmanager,
the Grid Monitor will not be used for that site.
The <I>condor_gridmanager</I> log file reports any problems
using the Grid Monitor.

<P>
The Grid Monitor is enabled by default,
and the
configuration macro <TT>GRID_MONITOR</TT><A NAME="48099"></A><A NAME="48100"></A> identifies
the location of the executable.

<P>

<H3><A NAME="SECTION00632600000000000000"></A><A NAME="sec:HTCondor-G-Limits"></A>
<A NAME="48085"></A>
<BR>
5.3.2.6 Limitations of HTCondor-G
</H3>
Submitting jobs to run under the grid universe has not yet
been perfected.
The following is a list of known limitations:

<P>

<OL>
<LI>No checkpoints.
</LI>
<LI>No job exit codes are available when using <B>gt2</B>.  
</LI>
<LI>Limited platform availability.  Windows support is not available.  
</LI>
</OL>

<P>
<A NAME="48091"></A>

<P>

<P>

<H2><A NAME="SECTION00633000000000000000"></A><A NAME="sec:NorduGrid"></A>
<A NAME="48121"></A>
<A NAME="48122"></A>
<BR>
5.3.3 The nordugrid Grid Type 
</H2>

<P>
NorduGrid is a project to develop free grid middleware named
the Advanced  Resource Connector (ARC).
See the NorduGrid web page (<A NAME="tex2html69"
  HREF="http://www.nordugrid.org">http://www.nordugrid.org</A>)
for more information about NorduGrid software.

<P>
HTCondor jobs may be submitted to
NorduGrid resources using the <B>grid</B> universe.
The <B>grid_resource</B><A NAME="48140"></A> command specifies the name of the
NorduGrid resource as follows:
<PRE>
grid_resource = nordugrid ng.example.com
</PRE>

<P>
NorduGrid uses X.509 credentials for authentication,
usually in the form a proxy certificate. 
<I>condor_submit</I> looks in default locations for the proxy. 
The submit description file command <B>x509userproxy</B><A NAME="48144"></A>
may be used to give the full path name to the directory containing the proxy,
when the proxy is not in a default location.
If this optional command is not present in the submit description file,
then the value of the environment variable
<TT>X509_USER_PROXY</TT> is checked for the location of the proxy.
If this environment variable is not present, then 
the proxy in the file
<TT>/tmp/x509up_uXXXX</TT> is used,
where the characters <code>XXXX</code> in this file name are
replaced with the Unix user id.

<P>
NorduGrid uses RSL syntax to describe jobs.
The submit description file command
<B>nordugrid_rsl</B><A NAME="48148"></A>
adds additional attributes to the job RSL that HTCondor
constructs. 
The format this submit description file command is
<PRE>
nordugrid_rsl = (name=value)(name=value)
</PRE>

<P>

<H2><A NAME="SECTION00634000000000000000"></A><A NAME="sec:Unicore"></A>
<A NAME="48160"></A>
<A NAME="48161"></A>
<BR>
5.3.4 The unicore Grid Type 
</H2>

<P>
Unicore is a Java-based grid scheduling system.
See <A NAME="tex2html70"
  HREF="http://www.unicore.eu/">http://www.unicore.eu/</A>
for more information about Unicore.

<P>
HTCondor jobs may be submitted to
Unicore resources using the <B>grid</B> universe.
The <B>grid_resource</B><A NAME="48179"></A> command specifies the name of the
Unicore resource as follows:
<PRE>
grid_resource = unicore usite.example.com vsite
</PRE>
<B>usite.example.com</B> is the host name of the Unicore gateway
machine to which the HTCondor job is to be submitted.
<B>vsite</B> is the name of the Unicore virtual resource to which
the HTCondor job is to be submitted.

<P>
Unicore uses certificates stored in a Java keystore file for
authentication. 
The following submit description file commands
are required to properly use the keystore file.

<P>
<DL>
<DT><STRONG><B>keystore_file</B><A NAME="48183"></A></STRONG></DT>
<DD>Specifies the complete path and file name of the Java keystore file to use. 
</DD>
<DT><STRONG><B>keystore_alias</B><A NAME="48185"></A></STRONG></DT>
<DD>A string that specifies which certificate in the
  Java keystore file to use. 
</DD>
<DT><STRONG><B>keystore_passphrase_file</B><A NAME="48187"></A></STRONG></DT>
<DD>Specifies the complete path and file name of the 
  file containing the passphrase protecting the certificate in the  
  Java keystore file.
</DD>
</DL>

<H2><A NAME="SECTION00635000000000000000"></A><A NAME="sec:batch"></A>
<A NAME="sec:PBS"></A><A NAME="sec:LSF"></A><A NAME="sec:SGE"></A><A NAME="48202"></A>
<BR>
5.3.5 The batch Grid Type (for PBS, LSF, and SGE) 
</H2>

<P>
The <B>batch</B> grid type is used to submit to a local PBS, LSF, or SGE
system using the <B>grid</B> universe and the
<B>grid_resource</B><A NAME="48257"></A> command by placing a variant of the following
into the submit description file.
<PRE>
grid_resource = batch pbs
</PRE>

<P>
The second argument on the right hand side will be one of
<TT>pbs</TT>, <TT>lsf</TT>, or <TT>sge</TT>.

<P>
Any of these batch grid types requires two variables to be set in the HTCondor
configuration file.
<TT>BATCH_GAHP</TT><A NAME="48262"></A><A NAME="48263"></A> is the path to the GAHP server binary that is to be
used to submit one of these batch jobs.
<TT>GLITE_LOCATION</TT><A NAME="48267"></A><A NAME="48268"></A> is the path to the directory containing the GAHP's
configuration file and auxiliary binaries.
In the HTCondor distribution, these files are located in 
<TT><TT>$(LIB)</TT>/glite</TT>.
The batch GAHP's configuration file is in
<TT><TT>$(GLITE_LOCATION)</TT>/etc/batch_gahp.config</TT>.
The batch GAHP's auxiliary binaries
are to be in the directory <TT><TT>$(GLITE_LOCATION)</TT>/bin</TT>.
The HTCondor configuration file appears

<P>
<PRE>
GLITE_LOCATION = $(LIB)/glite
BATCH_GAHP     = $(GLITE_LOCATION)/bin/batch_gahp
</PRE>
<P>
The batch GAHP's configuration file has variables that must be
modified to tell it where to find 
<DL>
<DT><STRONG>PBS</STRONG></DT>
<DD>on the local system.
  <TT>pbs_binpath</TT> is the directory that contains the PBS binaries.
  <TT>pbs_spoolpath</TT> is the PBS spool directory.
</DD>
<DT><STRONG>LSF</STRONG></DT>
<DD>on the local system.
  <TT>lsf_binpath</TT> is the directory that contains the LSF binaries.
  <TT>lsf_confpath</TT> is the location of the LSF configuration file.
</DD>
</DL>

<P>
<A NAME="48224"></A>
<A NAME="48225"></A>
The popular PBS (Portable Batch System) can be found at
<A NAME="tex2html71"
  HREF="http://www.pbsworks.com/">http://www.pbsworks.com/</A>,
and Torque is at
(<A NAME="tex2html72"
  HREF="http://www.adaptivecomputing.com/products/open-source/torque/">http://www.adaptivecomputing.com/products/open-source/torque/</A>).

<P>
As an alternative to the submission details given above,
HTCondor jobs may be submitted to a local PBS system
using the <B>grid</B> universe and the
<B>grid_resource</B> command by placing the following
into the submit description file.
<PRE>
grid_resource = pbs
</PRE>

<P>
<A NAME="48232"></A>
<A NAME="48233"></A>

<P>
HTCondor jobs may be submitted to the Platform LSF batch system.
Find the Platform product from the page
<A NAME="tex2html73"
  HREF="http://www.platform.com/Products/">http://www.platform.com/Products/</A>
for more information about Platform LSF.

<P>
As an alternative to the submission details given above,
HTCondor jobs may be submitted to a local Platform LSF system
using the <B>grid</B> universe and the
<B>grid_resource</B> command  by placing the following
into the submit description file.
<PRE>
grid_resource = lsf
</PRE>

<P>
<A NAME="48239"></A>
<A NAME="48240"></A>

<P>
The popular Grid Engine batch system (formerly known as Sun Grid Engine and
abbreviated SGE) is available in two varieties:
Oracle Grid Engine
(<A NAME="tex2html74"
  HREF="http://www.oracle.com/us/products/tools/oracle-grid-engine-075549.html">http://www.oracle.com/us/products/tools/oracle-grid-engine-075549.html</A>)
and Univa Grid Engine
(<A NAME="tex2html75"
  HREF="http://www.univa.com/?gclid=CLXg6-OEy6wCFWICQAodl0lm9Q">http://www.univa.com/?gclid=CLXg6-OEy6wCFWICQAodl0lm9Q</A>).

<P>
As an alternative to the submission details given above,
HTCondor jobs may be submitted to a local SGE system
using the <B>grid</B> universe and adding the
<B>grid_resource</B> command by placing
into the submit description file:
<PRE>
grid_resource = sge
</PRE>

<P>
The <I>condor_qsub</I> command line tool will take PBS/SGE style batch files or 
command line arguments and submit the job to HTCondor instead.
See the <I>condor_qsub</I> manual page at <A HREF="condor_qsub.html#man-condor-qsub">11</A> for details.

<H2><A NAME="SECTION00636000000000000000"></A><A NAME="sec:Amazon"></A>
<A NAME="48337"></A>
<A NAME="48338"></A>
<A NAME="48339"></A>
<A NAME="48340"></A>
<BR>
5.3.6 The EC2 Grid Type 
</H2>

<P>
HTCondor jobs may be submitted to clouds supporting
Amazon's Elastic Compute Cloud (EC2) interface.
The EC2 interface permits on-line commercial services that provide
the rental of computers by the hour to run computational applications.
They run virtual machine images that have been uploaded to Amazon's
online storage service (S3 or EBS).
More information about Amazon's EC2 service is available at
<A NAME="tex2html76"
  HREF="http://aws.amazon.com/ec2">http://aws.amazon.com/ec2</A>.

<P>
The <B>ec2</B> grid type uses the EC2 Query API,
also called the EC2 REST API.

<P>

<H3><A NAME="SECTION00636100000000000000"></A><A NAME="sec:Amazon-submit"></A>
<BR>
5.3.6.1 EC2 Job Submission
</H3>

<P>
HTCondor jobs are submitted to an EC2 service
with the <B>grid</B> universe, setting the
<B>grid_resource</B><A NAME="48419"></A> command to <B>ec2</B>, followed 
by the service's URL. For example,
partial contents of the submit description file may be
<PRE>
grid_resource = ec2 https://ec2.amazonaws.com/
</PRE>

<P>
Since the job is a virtual machine image,
most of the submit description file commands
specifying input or output files are not applicable.
The <B>executable</B><A NAME="48422"></A> command is still required,
but its value is ignored. 
It can be used to identify different jobs in the output of <I>condor_q</I>.

<P>
The VM image for the job must already reside in one of Amazon's storage
service (S3 or EBS) and be registered with EC2.
In the submit description file,
provide the identifier for the image using <B>ec2_ami_id</B><A NAME="48426"></A>.

<P>
<A NAME="48352"></A>
This grid type requires access to user authentication information,
in the form of path names to files containing the appropriate keys.

<P>
The <B>ec2</B> grid type has two different authentication methods.
The first authentication method uses the EC2 API's built-in authentication.
Specify the service with expected <TT>http://</TT> or <TT>https://</TT> URL,
and set the EC2 access key and secret access key as follows:

<P>
<PRE>
ec2_access_key_id = /path/to/access.key
ec2_secret_access_key = /path/to/secret.key
</PRE>

<P>
The <TT>euca3://</TT> and <TT>euca3s://</TT> protocols must use this 
authentication method.
These protocols exist to work correctly when the resources do not support
the <TT>InstanceInitiatedShutdownBehavior</TT> parameter.

<P>
The second authentication method for the EC2 grid type is X.509.
Specify the service with an <TT>x509://</TT> URL, 
even if the URL was given in another form.  
Use <B>ec2_access_key_id</B><A NAME="48435"></A> to 
specify the path to the X.509 public key (certificate),
which is not the same as the built-in authentication's access key.
<B>ec2_secret_access_key</B><A NAME="48437"></A> specifies the path to the X.509 
private key,
which is not the same as the built-in authentication's secret key.
The following example illustrates the specification for X.509 authentication:

<P>
<PRE>
grid_resource = ec2 x509://service.example
ec2_access_key_id = /path/to/x.509/public.key
ec2_secret_access_key = /path/to/x.509/private.key
</PRE>

<P>
If using an X.509 proxy, specify the proxy in both places.

<P>
HTCondor can use the EC2 API to create an SSH key pair that allows
secure log in to the virtual machine once it is running.
If the command
<B>ec2_keypair_file</B><A NAME="48439"></A>
is set in the submit description file,
HTCondor will write an SSH private key into the indicated file.
The key can be used to log into the virtual machine.
Note that modification will also be needed of the firewall
rules for the job to incoming SSH connections.

<P>
An EC2 service uses a firewall to restrict network access to 
the virtual machine instances it runs.
Typically, no incoming connections are allowed.
One can define sets of firewall rules and give them names.
The EC2 API calls these security groups. 
If utilized, tell HTCondor what set of security
groups should be applied to each VM using the
<B>ec2_security_groups</B><A NAME="48441"></A> submit description file command.
If not provided, HTCondor uses the security group <B>default</B>.

<P>
The EC2 API allows the choice of different hardware configurations 
for instances to run on.
Select which configuration to use for the <B>ec2</B> grid type
with the <B>ec2_instance_type</B><A NAME="48445"></A> submit description file command.
HTCondor provides no default.

<P>
Each virtual machine instance can be given up to 16 KiB of unique data, 
accessible by the instance by connecting to a well-known address.
This makes it easy for many instances to share the same VM image,
but perform different work.
This data can be specified to HTCondor in one of two ways.
First, the data can be provided directly in the submit description file 
using the <B>ec2_user_data</B><A NAME="48447"></A> command.
Second, the data can be
stored in a file, and the file name is specified with the
<B>ec2_user_data_file</B><A NAME="48449"></A> submit description file command.
This second option allows the use of binary data.
If both options are used, the two blocks of
data are concatenated, with the data from <B>ec2_user_data</B> 
occurring first.  HTCondor performs the base64 encoding that EC2 expects on 
the data.

<P>

<H3><A NAME="SECTION00636200000000000000"></A><A NAME="sec:EC2-termination"></A>
<BR>
5.3.6.2 Termination of EC2 Jobs
</H3>

<P>
A protocol defines the shutdown procedure for jobs running as
EC2 instances.
The service is told to shut down the instance,
and the service acknowledges.
The service then advances the instance to a state in which
the termination is imminent, but the job is given time to
shut down gracefully.

<P>
Once this state is reached, some services other than Amazon cannot be
relied upon to actually terminate the job.
Thus, HTCondor must check that the instance has terminated
before removing the job from the queue.
This avoids the possibility of HTCondor losing track of a job
while it is still accumulating charges on the service.  

<P>
HTCondor checks after a fixed time interval
that the job actually has terminated.
If the job has not terminated after a total of four checks,
the job is placed on hold.

<P>

<H3><A NAME="SECTION00636300000000000000"></A><A NAME="sec:spot-instances"></A>
<BR>
5.3.6.3 Using Spot Instances
</H3>

<P>
EC2 jobs may also be submitted to clouds that support spot instances.
A spot instance differs from a conventional, or dedicated, instance in two
primary ways.
First, the instance price varies according to demand.
Second,
the cloud provider may terminate the instance prematurely.
To start a spot instance,
the submitter specifies a bid,
which represents the most the submitter is willing to pay per hour
to run the VM.
<A NAME="48376"></A>
Within HTCondor, the submit command <B>ec2_spot_price</B><A NAME="48452"></A>
specifies this floating point value.
For example, 
to bid 1.1 cents per hour on Amazon:

<P>
<PRE>
ec2_spot_price = 0.011
</PRE>

<P>
Note that the EC2 API does not specify how the cloud provider 
should interpret the bid.
Empirically, Amazon uses fractional US dollars.

<P>
Other submission details for a spot instance are identical to those
for a dedicated instance.

<P>
A spot instance will not necessarily begin immediately.
Instead, 
it will begin as soon as the price drops below the bid.
Thus, spot instance jobs
may remain in the idle state for much longer than dedicated instance jobs,
as they wait for the price to drop.
Furthermore, if the price rises above the bid, 
the cloud service will terminate the instance.

<P>
More information about Amazon's spot instances is available at
<A NAME="tex2html77"
  HREF="http://aws.amazon.com/ec2/spot-instances/">http://aws.amazon.com/ec2/spot-instances/</A>.

<P>

<H3><A NAME="SECTION00636400000000000000"></A><A NAME="sec:Amazon-config"></A>
<BR>
5.3.6.4 EC2 Configuration Variables
</H3>

<P>
The <B>ec2</B> grid type requires these configuration variables 
to be set in the HTCondor configuration file:

<P>
<PRE>
EC2_GAHP     = $(SBIN)/ec2_gahp
EC2_GAHP_LOG = /tmp/EC2GahpLog.$(USERNAME)
</PRE>
<P>
The <B>ec2</B> grid type does not presently permit the explicit use 
of an HTTP proxy.

<P>
The specification of a service with an <TT>https://</TT>, an <TT>x509://</TT>,
or an <TT>euca3s://</TT> URL validates that service's certificate,
checking that a trusted certificate authority (CA) signed it.
Commercial EC2 service providers generally use certificates signed by 
widely-recognized CAs.
These CAs will usually work without any additional configuration.  
For other providers, a specification of trusted CAs may be needed.
Without, errors such as the following will be in the EC2 GAHP log:

<P>
<PRE>
06/13/13 15:16:16 curl_easy_perform() failed (60): 
'Peer certificate cannot be authenticated with given CA certificates'.
</PRE>
<P>
Specify trusted CAs by including their certificates in a group of trusted CAs
either in an on disk directory or in a single file. 
Either of these alternatives may contain multiple certificates.  
Which is used will vary from system to system, 
depending on the system's SSL implementation. 
HTCondor uses <I>libcurl</I>; 
information about the <I>libcurl</I> specification of trusted CAs
is available at 

<P>
<A NAME="tex2html78"
  HREF="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html</A>
<P>
Versions of HTCondor with standard universe support ship with their 
own <I>libcurl</I>, which will be linked against <I>OpenSSL</I>.

<P>
The behavior when specifying both a directory and a file is undefined, 
although the EC2 GAHP allows it.

<P>
The EC2 GAHP will set the CA file to whichever variable it finds first, 
checking these in the following order:

<P>

<OL>
<LI>The environment variable <TT>X509_CERT_FILE</TT>,
  set when the <I>condor_master</I> starts up.
</LI>
<LI>The HTCondor configuration variable <TT>SOAP_SSL_CA_FILE</TT><A NAME="48470"></A><A NAME="48471"></A>.
</LI>
</OL>

<P>
The EC2 GAHP supplies no default value, if it does not find a CA file.

<P>
The EC2 GAHP will set the CA directory given whichever of these
variables it finds first, 
checking in the following order:

<P>

<OL>
<LI>The HTCondor configuration variable <TT>GSI_DAEMON_TRUSTED_CA_DIR</TT><A NAME="48475"></A><A NAME="48476"></A>.
</LI>
<LI>The environment variable <TT>X509_CERT_DIR</TT>,
  set when the <I>condor_master</I> starts up.
</LI>
<LI>The HTCondor configuration variable <TT>SOAP_SSL_CA_DIR</TT><A NAME="48483"></A><A NAME="48484"></A>.
</LI>
</OL>

<P>
The EC2 GAHP supplies no default value, if it does not find a CA directory.

<P>
By default, HTCondor assumes that EC2 services are reliably available.
If an attempt to contact a service during the normal course of operation fails,
HTCondor makes a special attempt to contact the service.
If this attempt fails, 
the service is marked as down,
and normal operation for that service is
suspended until a subsequent special attempt succeeds.  
The jobs using that service do not go on hold.
To place jobs on hold when their service becomes unavailable,
set configuration variable <TT>EC2_RESOURCE_TIMEOUT</TT><A NAME="48488"></A><A NAME="48489"></A> to 
the number of seconds to delay before placing the job on hold.
The default value of -1 for this variable implements 
an infinite delay, such that the job is never placed on hold.
When setting this value, 
consider the value of configuration variable
<TT>GRIDMANAGER_RESOURCE_PROBE_INTERVAL</TT><A NAME="48493"></A><A NAME="48494"></A>,
which sets the number of seconds that HTCondor will wait after each
special contact attempt before trying again.

<H2><A NAME="SECTION00637000000000000000"></A><A NAME="sec:Gce"></A>
<A NAME="48596"></A>
<A NAME="48597"></A>
<A NAME="48598"></A>
<A NAME="48599"></A>
<BR>
5.3.7 The GCE Grid Type 
</H2>

<P>
HTCondor jobs may be submitted to the Google Compute Engine (GCE)
cloud service.
GCE is an on-line commercial service that provides
the rental of computers by the hour to run computational applications.
Its runs virtual machine images that have been uploaded to Google's
servers.
More information about Google Compute Engine is available at
<A NAME="tex2html79"
  HREF="http://cloud.google.com/Compute">http://cloud.google.com/Compute</A>.

<P>

<H3><A NAME="SECTION00637100000000000000"></A><A NAME="sec:Gce-submit"></A>
<BR>
5.3.7.1 GCE Job Submission
</H3>

<P>
HTCondor jobs are submitted to the GCE service
with the <B>grid</B> universe, setting the
<B>grid_resource</B><A NAME="48636"></A> command to <B>gce</B>, followed 
by the service's URL, your GCE project, 
and the desired GCE zone to be used.
The submit description file command will be similar to:
<PRE>
grid_resource = gce https://www.googleapis.com/compute/v1 my_proj us-central1-a
</PRE>

<P>
Since the HTCondor job is a virtual machine image,
most of the submit description file commands
specifying input or output files are not applicable.
The <B>executable</B><A NAME="48639"></A> command is still required,
but its value is ignored. 
It identifies different jobs in the output of <I>condor_q</I>.

<P>
The VM image for the job must already reside in Google's Cloud Storage
service and be registered with GCE.
In the submit description file,
provide the full URL identifier for the image using 
the <B>gce_image</B><A NAME="48643"></A> command.

<P>
This grid type requires granting HTCondor permission to use your
Google account. 
The easiest way to do this is to use the <I>gcloud</I>
command-line tool distributed by Google.
Find <I>gcloud</I> and documentation for it at
<A NAME="tex2html80"
  HREF="https://cloud.google.com/compute/docs/gcloud-compute/">https://cloud.google.com/compute/docs/gcloud-compute/</A>.
After installation of <I>gcloud</I>, 
run <I>gcloud auth login</I> and follow its directions.
Once done with that step,
the tool will write authorization credentials to the
file <TT>.config/gcloud/credentials</TT> under your HOME directory.

<P>
Given an authorization file, specify its location in
the submit description file using the <B>gce_auth_file</B><A NAME="48652"></A> command,
as in the example:
<PRE>
gce_auth_file = /path/to/auth-file
</PRE>

<P>
GCE allows the choice of different hardware configurations 
for instances to run on.
Select which configuration to use for the <B>gce</B> grid type
with the <B>gce_machine_type</B><A NAME="48655"></A> submit description file command.
HTCondor provides no default.

<P>
Each virtual machine instance can be given a unique set of metadata,
which consists of name/value pairs, similar to the environment variables
of regular jobs.
The instance can query its metadata via a well-known address.
This makes it easy for many instances to share the same VM image,
but perform different work.
This data can be specified to HTCondor in one of two ways.
First, the data can be provided directly in the submit description file 
using the <B>gce_metadata</B><A NAME="48657"></A> command.
The value should be a comma-separated list of name=value settings, 
as the example:
<PRE>
gce_metadata = setting1=foo,setting2=bar
</PRE>

<P>
Second, the data can be stored in a file, 
and the file name is specified with the
<B>gce_metadata_file</B><A NAME="48659"></A> submit description file command.
This second option allows a wider range of characters to be used in the
metadata values.
Each name=value pair should be on its own line.
No white space is removed from the lines, except for the newline that
separates entries.

<P>
Both options can be used at the same time, 
but do not use the same metadata name in both places.

<P>

<H3><A NAME="SECTION00637200000000000000"></A><A NAME="sec:Gce-config"></A>
<BR>
5.3.7.2 GCE Configuration Variables
</H3>

<P>
The following configuration parameters are specific to the <B>gce</B>
grid type. 
The values listed here are the defaults. 
Different values may be specified in the HTCondor configuration files.

<P>
<PRE>
GCE_GAHP     = $(SBIN)/gce_gahp
GCE_GAHP_LOG = /tmp/GceGahpLog.$(USERNAME)
</PRE>
<P>

<H2><A NAME="SECTION00638000000000000000"></A><A NAME="sec:CREAM"></A>
<A NAME="48694"></A>
<A NAME="48695"></A>
<BR>
5.3.8 The cream Grid Type 
</H2>

<P>
CREAM is a job submission interface being developed at INFN for the
gLite software stack. 
The CREAM homepage is <A NAME="tex2html81"
  HREF="http://grid.pd.infn.it/cream/">http://grid.pd.infn.it/cream/</A>.
The protocol is based on web services.

<P>
The protocol requires an X.509 proxy for the job,
so the submit description file command <B>x509userproxy</B><A NAME="48712"></A>
will be used.

<P>
A CREAM resource specification is of the form:
<PRE>
grid_resource = cream &lt;web-services-address&gt; &lt;batch-system&gt; &lt;queue-name&gt;
</PRE>The <code>&lt;web-services-address&gt;</code> appears the same for most servers,
differing only in the host name, as
<PRE>
&lt;machinename[:port]&gt;/ce-cream/services/CREAM2
</PRE>
Future versions of HTCondor may require only the host name, 
filling in other aspects of the web service for the user.

<P>
The <code>&lt;batch-system&gt;</code> is the name of the batch system that sits behind
the CREAM server,
into which it submits the jobs.
Normal values are <code>pbs</code>, <code>lsf</code>, and <code>condor</code>.

<P>
The <code>&lt;queue-name&gt;</code> identifies which queue within the batch system
should be used.
Values for this will vary by site, with no typical values.

<P>
A full example for the specification of a CREAM <B>grid_resource</B><A NAME="48714"></A> is
<PRE>
grid_resource = cream https://cream-12.pd.infn.it:8443/ce-cream/services/CREAM2
   pbs cream_1
</PRE>This is a single line within the submit description file,
although it is shown here on two lines for formatting reasons.

<P>
CREAM uses ClassAd syntax to describe jobs, although the attributes used
are different than those for HTCondor.
The submit description file command
<B>cream_attributes</B><A NAME="48716"></A>
adds additional attributes to the CREAM-style job ClassAd that HTCondor
constructs. 
The format for this submit description file command is
<PRE>
cream_attributes = name=value;name=value
</PRE>

<H2><A NAME="SECTION00639000000000000000"></A><A NAME="sec:Deltacloud"></A>
<A NAME="48742"></A>
<A NAME="48743"></A>
<BR>
5.3.9 The deltacloud Grid Type 
</H2>

<P>
HTCondor jobs may be submitted to Deltacloud services.
Deltacloud is a translation service for cloud services,
with more information at <A NAME="tex2html82"
  HREF="http://deltacloud.apache.org/">http://deltacloud.apache.org/</A>.
Cloud services allow the rental of computers by the hour to run
computation applications.
Many cloud services define their own protocol for users to communicate
with them.
Deltacloud defines its own simple protocol and translates a user's
commands into the appropriate protocol for the cloud service the user
specifies.
Anyone can set up a Deltacloud service and configure it to translate
for a specific cloud service.

<P>

<H3><A NAME="SECTION00639100000000000000"></A><A NAME="sec:Deltacloud-submit"></A>
<BR>
5.3.9.1 Deltacloud Job Submission
</H3>

<P>
HTCondor jobs are submitted to Deltacloud
using the <B>grid</B> universe and the
<B>grid_resource</B><A NAME="48773"></A> command
in the submit description file
following this example:
<PRE>
grid_resource = deltacloud https://deltacloud.foo.org/api
</PRE>

<P>
The URL in this example will be replaced with the URL of the
Deltacloud service desired.

<P>
Since the job is a virtual machine image,
most of the submit description file commands
specifying input or output files are not applicable.
The <B>executable</B><A NAME="48775"></A> command is still required,
but its value is ignored. 
It can be used to identify different jobs in the output of <I>condor_q</I>.

<P>
The VM image for the job must already be stored and registered with the
cloud service.
In the submit description file,
provide the identifier for the image using the
<B>deltacloud_image_id</B><A NAME="48779"></A> command.

<P>
To authenticate with Deltacloud, HTCondor needs your credentials for
the cloud service that the Deltacloud server is representing. 
The credentials are
presented as a user name and the name of a file that holds a secret key.
Both are specified in the submit description file:

<P>
<PRE>
deltacloud_username = your_username
deltacloud_password_file = /path/to/file/with/password
</PRE>

<P>
You can create and register an SSH key pair with the cloud service,
which you can then use to securely log in to virtual machines,
once running.
The command <B>deltacloud_keyname</B><A NAME="48781"></A> in the
submit description file specifies the identifier of the SSH key pair
to use.

<P>
The cloud service may have multiple locations where the virtual
machine can run. 
The submit description file command <B>deltacloud_realm_id</B><A NAME="48783"></A>
selects one.
If not specified, the service will select a sensible default.

<P>
The cloud service may offer several hardware configurations for
instances to run on.
Select which configuration to use with the
<B>deltacloud_hardware_profile</B><A NAME="48785"></A> submit description file command. 
If not specified, the cloud service will select a sensible default.
The optional commands <B>deltacloud_hardware_profile_memory</B><A NAME="48787"></A>,
<B>deltacloud_hardware_profile_cpu</B><A NAME="48789"></A>, and
<B>deltacloud_hardware_profile_storage</B><A NAME="48791"></A>
customize the selected hardware profile.

<P>
Each virtual machine instance can be given some unique data, 
accessible by the instance connecting to a well-known address.
This makes it easy for many instances to share the same VM image,
but perform different work.
This data can be specified with the submit description file command
<B>deltacloud_user_data</B><A NAME="48793"></A>.
The amount of data that can be provided depends on the cloud service.
EC2 services allow up to 16Kb of data.

<P>

<H3><A NAME="SECTION00639200000000000000"></A><A NAME="sec:Deltacloud-config"></A>
<BR>
5.3.9.2 Configuration for Deltacloud
</H3>

<P>
One configuration variable 
must be set for Deltacloud.
It specifies the path and executable of the <I>deltacloud_gahp</I>:

<P>
<PRE>
DELTACLOUD_GAHP = $(SBIN)/deltacloud_gahp
</PRE>
<H2><A NAME="SECTION006310000000000000000"></A><A NAME="sec:Gce"></A>
<A NAME="48830"></A>
<A NAME="48831"></A>
<A NAME="48832"></A>
<A NAME="48833"></A>
<BR>
5.3.10 The BOINC Grid Type 
</H2>

<P>
HTCondor jobs may be submitted to BOINC (Berkeley Open Infrastructure
for Network Computing) servers.
BOINC is a software system for volunteer computing.
More information about BOINC is available at
<A NAME="tex2html83"
  HREF="http://boinc.berkeley.edu/">http://boinc.berkeley.edu/</A>.

<P>

<H3><A NAME="SECTION006310100000000000000"></A><A NAME="sec:Boinc-submit"></A>
<BR>
5.3.10.1 BOINC Job Submission
</H3>

<P>
HTCondor jobs are submitted to a BOINC service
with the <B>grid</B> universe, setting the
<B>grid_resource</B><A NAME="48855"></A> command to <B>boinc</B>, followed 
by the service's URL.

<P>
To use this grid type, you must have an account on the BOINC server
that is authorized to submit jobs.
Provide the authenticator string for that account for
HTCondor to use.
Write the authenticator string in a file and specify its location in
the submit description file using the
<B>boinc_authenticator_file</B><A NAME="48858"></A> command, as in the example:
<PRE>
boinc_authenticator_file = /path/to/auth-file
</PRE>

<P>
Before submitting BOINC jobs, register the application
with the BOINC server.
This includes describing the application's resource requirements and
input and output files, and placing application files on the server.
This is a manual process that is done on the BOINC server.
See the BOINC documentation for details.

<P>
In the submit description file, the <B>executable</B><A NAME="48860"></A> command
gives the registered name of the application on the BOINC server.
Input and output files can be described as in the vanilla universe,
but the file names must match the application description on the
BOINC server.
If <B>transfer_output_files</B><A NAME="48862"></A> is omitted, then all output
files are transferred.

<P>

<H3><A NAME="SECTION006310200000000000000"></A><A NAME="sec:Boinc-config"></A>
<BR>
5.3.10.2 BOINC Configuration Variables
</H3>

<P>
The following configuration variable is specific to the <B>boinc</B>
grid type. 
The value listed here is the default. 
A different value may be specified in the HTCondor configuration files.

<P>
<PRE>
BOINC_GAHP = $(SBIN)/boinc_gahp
</PRE>
<H2><A NAME="SECTION006311000000000000000"></A><A NAME="sec:Grid-Matchmaking"></A>
<A NAME="48887"></A>
<A NAME="48888"></A>
<BR>
5.3.11 Matchmaking in the Grid Universe
</H2>

<P>
In a simple usage, the grid universe allows users to specify a single
grid site as a destination for jobs.
This is sufficient when a user knows exactly which
grid site they wish to use,
or a higher-level resource broker
(such as the European Data Grid's resource broker)
has decided which grid site should be used.

<P>
When a user has a variety of grid sites to choose from,
HTCondor allows matchmaking of grid universe jobs
to decide which grid resource a job should run on. 
Please note that this form of matchmaking is relatively new.
There are some rough edges as continual improvement occurs.

<P>
To facilitate HTCondor's matching of jobs with grid resources,
both the jobs and the grid resources are involved.
The job's submit description file provides all commands
needed to make the
job work on a matched grid resource.
The grid resource identifies itself to HTCondor by advertising
a ClassAd.
This ClassAd specifies all necessary attributes, such that HTCondor
can properly make matches.
The grid resource identification is accomplished by 
using <I>condor_advertise</I> to send a ClassAd representing the
grid resource, which is then used by HTCondor to make matches.

<P>

<H3><A NAME="SECTION006311100000000000000">
5.3.11.1 Job Submission</A>
</H3>

<P>
To submit a grid universe job intended for a single, specific
<B>gt2</B> resource,
the submit description file for the job explicitly specifies
the resource:

<P>
<PRE>
grid_resource = gt2 grid.example.com/jobmanager-pbs
</PRE>
<P>
If there were multiple <B>gt2</B> resources that
might be matched to the job,
the submit description file changes:

<P>
<PRE>
grid_resource   = $$(resource_name)
requirements    = TARGET.resource_name =!= UNDEFINED
</PRE>
<P>
The <B>grid_resource</B><A NAME="48989"></A> command uses a substitution
macro.
The substitution macro defines the value 
of <TT>resource_name</TT> using attributes
as specified by the matched grid resource.
The <B>requirements</B><A NAME="48992"></A> command further restricts that
the job may only run on a machine (grid resource) that
defines <TT>grid_resource</TT>.
Note that this attribute name is invented for this example.
To make matchmaking work in this way,
both the job (as used here within the submit description file)
and the grid resource (in its created and advertised ClassAd)
must agree upon the name of the attribute.

<P>
As a more complex example,
consider a job that wants
to run not only
on a <B>gt2</B> resource,
but on one that has the Bamboozle software installed.
The complete submit description file might appear:

<P>
<PRE>
universe        = grid
executable      = analyze_bamboozle_data
output          = aaa.$(Cluster).out
error           = aaa.$(Cluster).err
log             = aaa.log
grid_resource   = $$(resource_name)
requirements    = (TARGET.HaveBamboozle == True) &amp;&amp; (TARGET.resource_name =!= UNDEFINED)
queue
</PRE>
<P>
Any grid resource which has the
<TT>HaveBamboozle</TT> attribute defined as well as
set to <TT>True</TT> is further checked to have the
<TT>resource_name</TT> attribute defined.
Where this occurs, a match may be made (from the
job's point of view).
A grid resource that has one of these attributes defined,
but not the other results in no match being made.

<P>
Note that the entire value of <B>grid_resource</B> comes from
the grid resource's ad. This means that the job can be matched with
a resource of any type, not just <B>gt2</B>.

<P>

<H3><A NAME="SECTION006311200000000000000">
5.3.11.2 Advertising Grid Resources to HTCondor</A>
</H3>

<P>
Any grid resource that wishes to be matched by HTCondor with
a job must advertise itself to HTCondor using a ClassAd.
To properly advertise, a ClassAd is sent
periodically to the <I>condor_collector</I> daemon.
A ClassAd is a list of pairs, where each pair consists of
an attribute name and value that describes an entity.
There are two entities relevant to HTCondor:
a job, and a machine.
A grid resource is a machine.
The ClassAd describes the grid resource, as well
as identifying the capabilities of the grid resource.
It may also state both requirements and preferences
(called <B>rank</B><A NAME="49003"></A>) for the jobs it will run.
See
Section&nbsp;<A HREF="2_3Matchmaking_with.html#sec:matchmaking-with-classads">2.3</A> for an overview
of the interaction between matchmaking and ClassAds.
A list of common machine ClassAd attributes is given in
the Appendix on page&nbsp;<A HREF="12_Appendix_A.html#sec:Machine-ClassAd-Attributes"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.

<P>
To advertise a grid site, place the attributes
in a file.
Here is a sample ClassAd that describes a grid resource
that is capable of running a
<B>gt2</B> job.

<P>
<PRE>
# example grid resource ClassAd for a gt2 job
MyType         = "Machine"
TargetType     = "Job"
Name           = "Example1_Gatekeeper"
Machine        = "Example1_Gatekeeper"
resource_name  = "gt2 grid.example.com/jobmanager-pbs"
UpdateSequenceNumber  = 4
Requirements   = (TARGET.JobUniverse == 9)
Rank           = 0.000000
CurrentRank    = 0.000000
</PRE>
<P>
Some attributes are defined as expressions, while
others are integers, floating point values, or strings.
The type is important, and must be correct for the
ClassAd to be effective.
The attributes
<PRE>
MyType         = "Machine"
TargetType     = "Job"
</PRE>
identify the grid resource as a machine,
and that the machine is to be matched with a job.
In HTCondor, machines are matched with jobs, and jobs are matched with
machines.
These attributes are strings.
Strings are surrounded by double quote marks.

<P>
The attributes <TT>Name</TT> and <TT>Machine</TT>
are likely to be defined to be the same string value as in the
example:
<PRE>
Name           = "Example1_Gatekeeper"
Machine        = "Example1_Gatekeeper"
</PRE>
<P>
Both give the fully qualified host name for the resource.
The <TT>Name</TT> may be different on an SMP machine,
where the individual CPUs are given names that can
be distinguished from each other.
Each separate grid resource must have a unique name.

<P>
Where the job depends on the resource to specify the
value of the <B>grid_resource</B><A NAME="49009"></A> command by
the use of the substitution macro,
the ClassAd for the grid resource (machine)
defines this value.
The example given as
<PRE>
grid_resource = "gt2 grid.example.com/jobmanager-pbs"
</PRE>defines this value.
Note that the invented name of this variable must match the
one utilized within the submit description file.
To make the matchmaking work,
both the job (as used within the submit description file)
and the grid resource (in this created and advertised ClassAd)
must agree upon the name of the attribute.

<P>
A machine's ClassAd information can be time sensitive,
and may change over time.
Therefore, ClassAds expire and are thrown away.
In addition, the communication method by which ClassAds
are sent implies that entire ads may be lost without notice
or may arrive out of order.
Out of order arrival leads to the definition of an
attribute which provides an ordering.
This positive integer value is given in the example
ClassAd as
<PRE>
UpdateSequenceNumber  = 4
</PRE>This value must increase for each subsequent ClassAd.
If state information for the ClassAd is kept in a file,
a script executed each time the ClassAd is to be sent
may use a counter for this value.
An alternative for a stateless implementation sends
the current time in seconds (since the epoch, as given by
the C <TT>time()</TT> function call).

<P>
The requirements that the grid resource sets for any job
that it will accept are given as
<PRE>
Requirements     = (TARGET.JobUniverse == 9)
</PRE>This set of requirements state that any job is
required to be for the <B>grid</B> universe.

<P>
The attributes
<PRE>
Rank             = 0.000000
CurrentRank      = 0.000000
</PRE>are both necessary for HTCondor's negotiation to proceed,
but are not relevant to grid matchmaking.
Set both to the floating point value 0.0.

<P>
The example machine ClassAd becomes more complex
for the case where the grid resource allows matches with more
than one job:
<PRE>
# example grid resource ClassAd for a gt2 job
MyType         = "Machine"
TargetType     = "Job"
Name           = "Example1_Gatekeeper"
Machine        = "Example1_Gatekeeper"
resource_name  = "gt2 grid.example.com/jobmanager-pbs"
UpdateSequenceNumber  = 4
Requirements   = (CurMatches &lt; 10) &amp;&amp; (TARGET.JobUniverse == 9)
Rank           = 0.000000
CurrentRank    = 0.000000
WantAdRevaluate = True
CurMatches     = 1
</PRE>
<P>
In this example, the two attributes <TT>WantAdRevaluate</TT>
and <TT>CurMatches</TT> appear, and the <TT>Requirements</TT>
expression has changed.

<P>
<TT>WantAdRevaluate</TT> is a boolean value, and may be set to
either <TT>True</TT> or <TT>False</TT>.
When <TT>True</TT> in the ClassAd and a match is made (of a job
to the grid resource), the machine (grid resource)
is not removed from the set of machines to be considered for
further matches.
This implements the ability for a single grid resource to
be matched to more than one job at a time.
Note that the spelling of this attribute is incorrect,
and remains incorrect to maintain backward compatibility.

<P>
To limit the number of matches made to the single grid resource,
the resource must have the ability to keep track of the number 
of HTCondor jobs it has.
This integer value is given as the <TT>CurMatches</TT> attribute
in the advertised ClassAd.
It is then compared in order to limit the number of jobs matched
with the grid resource.
<PRE>
Requirements   = (CurMatches &lt; 10) &amp;&amp; (TARGET.JobUniverse == 9)
CurMatches     = 1
</PRE>
<P>
This example assumes that the grid resource already has
one job, and is willing to accept a maximum of 9 jobs.
If <TT>CurMatches</TT> does not appear in the ClassAd,
HTCondor uses a default value of 0.

<P>
<A NAME="49021"></A><A NAME="49022"></A>
<A NAME="49025"></A><A NAME="49026"></A>
For multiple matching of a site ClassAd to work correctly,
it is also necessary to add the following to the configuration file
read by the <I>condor_negotiator</I>:

<P>
<PRE>
NEGOTIATOR_MATCHLIST_CACHING = False
NEGOTIATOR_IGNORE_USER_PRIORITIES = True
</PRE>

<P>
This ClassAd (likely in a file)
is to be periodically sent to the <I>condor_collector</I> daemon
using <I>condor_advertise</I>.
A recommended implementation uses a script to create or modify
the ClassAd together with
<I>cron</I> to send the ClassAd every five minutes.
The <I>condor_advertise</I> program must be installed on the 
machine sending the ClassAd, but the remainder of HTCondor
does not need to be installed.
The required argument for the <I>condor_advertise</I> command
is <I>UPDATE_STARTD_AD</I>.

<P>
<I>condor_advertise</I> uses UDP to transmit the ClassAd.
Where this is insufficient,
specify the <B>-tcp</B> option to <I>condor_advertise</I>
to use TCP for communication. 

<P>

<H3><A NAME="SECTION006311300000000000000">
5.3.11.3 Advanced usage</A>
</H3>

<P>
What if a job fails to run at a grid site due to an error? It will be
returned to the queue, and HTCondor will attempt to match it and
re-run it at another site. HTCondor isn't very clever about avoiding
sites that may be bad, but you can give it some assistance. Let's say
that you want to avoid running at the last grid site you ran at. You
could add this to your job description:

<P>
<PRE>
match_list_length = 1
Rank              = TARGET.Name != LastMatchName0
</PRE>
<P>
This will prefer to run at a grid site that was not just tried, but it
will allow the job to be run there if there is no other option. 

<P>
When you specify <B>match_list_length</B>, you provide an integer N, and
HTCondor will keep track of the last N matches. The oldest match will be
LastMatchName0, and next oldest will be LastMatchName1, and so on. (See
the <I>condor_submit</I> manual page for more details.) The Rank expression
allows you to specify a numerical ranking for different matches. When
combined with <B>match_list_length</B>, you can prefer to avoid sites that
you have already run at. 

<P>
In addition, <I>condor_submit</I> has two options to help control
grid universe job resubmissions and rematching.  
See the definitions of the submit description file commands
<B>globus_resubmit</B> and <B>globus_rematch</B> at 
page <A HREF="condor_submit.html#condor-submit-globus-rematch"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> and
page <A HREF="condor_submit.html#condor-submit-globus-resubmit"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.
These options are independent of <B>match_list_length</B>.

<P>
There are some new attributes that will be added to the Job ClassAd,
and may be useful to you when you write your rank, requirements,
globus_resubmit or globus_rematch option. Please refer to
the Appendix on page&nbsp;<A HREF="12_Appendix_A.html#sec:Job-ClassAd-Attributes"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> 
to see a list containing the following attributes:

<P>

<UL>
<LI>NumJobMatches
</LI>
<LI>NumGlobusSubmits
</LI>
<LI>NumSystemHolds
</LI>
<LI>HoldReason
</LI>
<LI>ReleaseReason
</LI>
<LI>EnteredCurrentStatus
</LI>
<LI>LastMatchTime
</LI>
<LI>LastRejMatchTime
</LI>
<LI>LastRejMatchReason
</LI>
</UL>

<P>
The following example of a command within the submit description file
releases jobs 5 minutes after being held,
increasing the time between releases by 5 minutes each time.
It will continue to retry up to 4 times per Globus
submission, plus 4.
The plus 4 is necessary in case
the job goes on hold before being submitted to Globus, although
this is unlikely.

<P>
<PRE>
periodic_release = ( NumSystemHolds &lt;= ((NumGlobusSubmits * 4) + 4) ) \
   &amp;&amp; (NumGlobusSubmits &lt; 4) &amp;&amp; \
   ( HoldReason != "via condor_hold (by user $ENV(USER))" ) &amp;&amp; \
   ((time() - EnteredCurrentStatus) &gt; ( NumSystemHolds *60*5 ))
</PRE>
<P>
The following example forces Globus resubmission after a job has
been held 4 times per Globus submission.

<P>
<PRE>
globus_resubmit = NumSystemHolds == (NumGlobusSubmits + 1) * 4
</PRE>
<P>
If you are concerned about unknown or malicious grid sites reporting
to your <I>condor_collector</I>, you should use HTCondor's security options,
documented in Section&nbsp;<A HREF="3_6Security.html#sec:Security">3.6</A>.
<HR>
<!--Navigation Panel-->
<A NAME="tex2html2028"
  HREF="5_4HTCondor_Job.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2022"
  HREF="5_Grid_Computing.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2016"
  HREF="5_2Connecting_HTCondor.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2024"
  HREF="Contents.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2026"
  HREF="Index.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html2029"
  HREF="5_4HTCondor_Job.html">5.4 The HTCondor Job</A>
<B> Up:</B> <A NAME="tex2html2023"
  HREF="5_Grid_Computing.html">5. Grid Computing</A>
<B> Previous:</B> <A NAME="tex2html2017"
  HREF="5_2Connecting_HTCondor.html">5.2 Connecting HTCondor Pools</A>
 &nbsp; <B>  <A NAME="tex2html2025"
  HREF="Contents.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html2027"
  HREF="Index.html">Index</A></B> 
<!--End of Navigation Panel-->

</BODY>
</HTML>
